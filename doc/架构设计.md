# ğŸ—ï¸ LinguaFlow æ¶æ„è®¾è®¡æ–‡æ¡£

## ç›®å½•
1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æŠ€æœ¯é€‰å‹](#æŠ€æœ¯é€‰å‹)
3. [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
4. [åç«¯æ¶æ„](#åç«¯æ¶æ„)
5. [å‰ç«¯æ¶æ„](#å‰ç«¯æ¶æ„)
6. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
7. [APIè®¾è®¡](#apiè®¾è®¡)
8. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
9. [å®‰å…¨è®¾è®¡](#å®‰å…¨è®¾è®¡)
10. [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)

---

## ç³»ç»Ÿæ¦‚è¿°

### äº§å“å®šä½
LinguaFlowæ˜¯ä¸€ä¸ªç§»åŠ¨ç«¯ä¼˜å…ˆçš„ç¤¾äº¤åŒ–è‹±è¯­å­¦ä¹ å¹³å°ï¼Œé€šè¿‡å°è¯´é˜…è¯»å’Œæ¸¸æˆåŒ–é—¯å…³ï¼Œæä¾›æ²‰æµ¸å¼çš„è‹±è¯­å­¦ä¹ ä½“éªŒã€‚

### æ ¸å¿ƒåŠŸèƒ½
1. **Feedæµ**: ç±»Xçš„ç¤¾äº¤ä¿¡æ¯æµ
2. **å°è¯´é˜…è¯»**: ç”µå­ä¹¦é˜…è¯»å™¨
3. **é—¯å…³ç³»ç»Ÿ**: å¤šæ ·åŒ–è‹±è¯­æŒ‘æˆ˜
4. **AIè¯„åˆ†**: æ™ºèƒ½è¯„åˆ†å’Œåé¦ˆ
5. **ç¤¾äº¤äº’åŠ¨**: ç‚¹èµã€è¯„è®ºã€åˆ†äº«

### ç”¨æˆ·æµç¨‹
```
Feedæµæµè§ˆ â†’ ç‚¹å‡»å¡ç‰‡ â†’ æŸ¥çœ‹è¯¦æƒ… â†’ å¼€å§‹å­¦ä¹  
  â†’ é˜…è¯»ç« èŠ‚ â†’ å®ŒæˆæŒ‘æˆ˜ â†’ è·å¾—åé¦ˆ â†’ åˆ†äº«æˆæœ
```

---

## æŠ€æœ¯é€‰å‹

### å‰ç«¯æŠ€æœ¯æ ˆ

#### æ ¸å¿ƒæ¡†æ¶
- **Next.js 15**: 
  - App Routeræ¶æ„
  - SSR/SSGä¼˜åŒ–SEO
  - API Routesç®€åŒ–åç«¯
  - å›¾ç‰‡ä¼˜åŒ–
  
- **React 19**:
  - æœ€æ–°ç‰¹æ€§æ”¯æŒ
  - å¹¶å‘æ¸²æŸ“
  - Suspenseè¾¹ç•Œ

- **TypeScript**:
  - ç±»å‹å®‰å…¨
  - æ›´å¥½çš„IDEæ”¯æŒ
  - å‡å°‘è¿è¡Œæ—¶é”™è¯¯

#### UIæ¡†æ¶
- **Tailwind CSS 4**:
  - åŸå­åŒ–CSS
  - é«˜åº¦å¯å®šåˆ¶
  - ä¼˜ç§€çš„DX
  
- **Framer Motion**:
  - å£°æ˜å¼åŠ¨ç”»
  - Springç‰©ç†åŠ¨ç”»
  - æ‰‹åŠ¿æ”¯æŒ

#### çŠ¶æ€ç®¡ç†
- **Zustand**: è½»é‡çº§å…¨å±€çŠ¶æ€
- **TanStack Query**: æœåŠ¡ç«¯çŠ¶æ€ç¼“å­˜
- **Jotai**: åŸå­åŒ–çŠ¶æ€ï¼ˆç»†ç²’åº¦æ›´æ–°ï¼‰

#### æ€§èƒ½ä¼˜åŒ–
- **React Virtuoso**: è™šæ‹Ÿæ»šåŠ¨
- **next/image**: å›¾ç‰‡ä¼˜åŒ–
- **Dynamic Import**: ä»£ç åˆ†å‰²

### åç«¯æŠ€æœ¯æ ˆ

#### Supabaseç”Ÿæ€
- **PostgreSQL**: å…³ç³»æ•°æ®åº“
- **Supabase Auth**: ç”¨æˆ·è®¤è¯
- **Supabase Storage**: æ–‡ä»¶å­˜å‚¨
- **Supabase Realtime**: WebSocketå®æ—¶è®¢é˜…
- **Edge Functions**: Serverlesså‡½æ•°

#### AIé›†æˆ
- **OpenAI GPT-4**: å†…å®¹ç”Ÿæˆã€è¯„åˆ†
- **Anthropic Claude**: æ•™å­¦åé¦ˆï¼ˆå¤‡é€‰ï¼‰

---

## æ•´ä½“æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·è®¾å¤‡                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            Next.js App (PWA)                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  Feedæµ    â”‚  â”‚  é˜…è¯»å™¨    â”‚  â”‚  æŒ‘æˆ˜ç³»ç»Ÿ  â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Supabase Cloud                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL  â”‚  â”‚    Auth      â”‚  â”‚   Storage    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚   Realtime   â”‚  â”‚ Edge Functionsâ”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AIæœåŠ¡                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  OpenAI API  â”‚  â”‚ Anthropic APIâ”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åç«¯æ¶æ„

### ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‰ç«¯åº”ç”¨å±‚ (Multiple Clients)      â”‚
â”‚  Web App  â”‚  å°ç¨‹åº  â”‚  iOS  â”‚  Android  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ HTTP/HTTPS
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          API è·¯ç”±å±‚ (Routes)             â”‚
â”‚  /api/feed  â”‚  /api/quests  â”‚  /api/usersâ”‚
â”‚  â”œâ”€ è®¤è¯ä¸­é—´ä»¶                            â”‚
â”‚  â”œâ”€ CORS ä¸­é—´ä»¶                           â”‚
â”‚  â”œâ”€ æ—¥å¿—ä¸­é—´ä»¶                            â”‚
â”‚  â””â”€ é”™è¯¯å¤„ç†ä¸­é—´ä»¶                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä¸šåŠ¡é€»è¾‘å±‚ (Services)              â”‚
â”‚  FeedService  â”‚  QuestService  â”‚  UserServiceâ”‚
â”‚  â”œâ”€ ä¸šåŠ¡è§„åˆ™éªŒè¯                          â”‚
â”‚  â”œâ”€ æƒé™æ£€æŸ¥                              â”‚
â”‚  â””â”€ æ•°æ®è½¬æ¢                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ•°æ®è®¿é—®å±‚ (Database)             â”‚
â”‚         Supabase PostgreSQL              â”‚
â”‚  feed_cards  â”‚  quests  â”‚  profiles     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç‰¹æ€§

- âœ… **æ ‡å‡†åŒ–**: RESTful API + ç»Ÿä¸€å“åº”æ ¼å¼
- âœ… **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹ç³»ç»Ÿ
- âœ… **æ•°æ®å¯¹é½**: æ•°æ®åº“ã€DTOã€å‰ç«¯ä¸‰å±‚å­—æ®µå¯¹é½
- âœ… **å¤šç«¯æ”¯æŒ**: Webã€å°ç¨‹åºã€App é€šç”¨
- âœ… **å¯ç»´æŠ¤**: æ¸…æ™°çš„åˆ†å±‚æ¶æ„
- âœ… **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½
- âœ… **é«˜æ€§èƒ½**: Vercel Edge + Supabase
- âœ… **å®‰å…¨å¯é **: è®¤è¯ã€æƒé™ã€RLS

### æ•°æ®æµè®¾è®¡

#### Feedæµæ•°æ®æµ
```
ç”¨æˆ·è¯·æ±‚ â†’ Next.js SSR â†’ Supabase Query â†’ 
  â†’ è¿”å›æ•°æ® â†’ å®¢æˆ·ç«¯ç¼“å­˜ â†’ æ¸²æŸ“Feed
  
å®æ—¶æ›´æ–° â†’ Supabase Realtime â†’ WebSocket â†’ 
  â†’ å®¢æˆ·ç«¯æ¥æ”¶ â†’ ä¹è§‚æ›´æ–° â†’ æ¨ªå¹…æç¤º
```

#### å­¦ä¹ æµç¨‹æ•°æ®æµ
```
å¼€å§‹é˜…è¯» â†’ è®°å½•è¿›åº¦ â†’ å®Œæˆé˜…è¯» â†’ è§¦å‘æŒ‘æˆ˜
  â†’ æäº¤ç­”æ¡ˆ â†’ Edge Function â†’ AIè¯„åˆ†
  â†’ è¿”å›ç»“æœ â†’ æ›´æ–°è¿›åº¦ â†’ è§£é”ä¸‹ä¸€å…³
```

---

## æ•°æ®åº“è®¾è®¡

### ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   profiles  â”‚â”€â”€â”€â”€â”€â”€â”€â”‚ feed_cards  â”‚â”€â”€â”€â”€â”€â”€â”€â”‚interactions â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚
       â”‚                     â”‚
       â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚user_progressâ”‚       â”‚novel_chaptersâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚
       â”‚                     â†“
       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ challenges  â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚challenge_   â”‚
                      â”‚  results    â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè¡¨è®¾è®¡

#### profiles (ç”¨æˆ·è¡¨)
```sql
- id: UUID (PK, FK to auth.users)
- username: VARCHAR(50) UNIQUE
- full_name: TEXT
- avatar_url: TEXT
- level: INTEGER
- experience: INTEGER
- streak_days: INTEGER
```

#### feed_cards (Feedå¡ç‰‡è¡¨)
```sql
- id: UUID (PK)
- type: VARCHAR(20) -- 'novel', 'text', 'image'...
- author_id: UUID (FK to profiles)
- content: JSONB -- çµæ´»å­˜å‚¨ä¸åŒç±»å‹å†…å®¹
- likes_count: INTEGER
- comments_count: INTEGER
- visibility: VARCHAR(20)
```

#### novel_chapters (ç« èŠ‚è¡¨)
```sql
- id: UUID (PK)
- feed_card_id: UUID (FK)
- chapter_number: INTEGER
- title: VARCHAR(255)
- content: TEXT
- difficulty_level: INTEGER (1-10)
- key_vocabulary: JSONB
- grammar_points: JSONB
```

#### challenges (æŒ‘æˆ˜è¡¨)
```sql
- id: UUID (PK)
- chapter_id: UUID (FK)
- type: VARCHAR(20) -- 'vocabulary', 'grammar'...
- order_index: INTEGER
- config: JSONB -- æŒ‘æˆ˜é…ç½®
- passing_score: INTEGER
```

#### user_progress (ç”¨æˆ·è¿›åº¦è¡¨)
```sql
- id: UUID (PK)
- user_id: UUID (FK)
- chapter_id: UUID (FK)
- status: VARCHAR(20)
- best_score: INTEGER
- attempts: INTEGER
- challenges_completed: JSONB
```

### ç´¢å¼•ç­–ç•¥

```sql
-- FeedæµæŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_feed_cards_created ON feed_cards(created_at DESC);
CREATE INDEX idx_feed_cards_type ON feed_cards(type);

-- ç”¨æˆ·è¿›åº¦æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_progress_user ON user_progress(user_id);
CREATE INDEX idx_progress_status ON user_progress(status);

-- å…¨æ–‡æœç´¢
CREATE INDEX idx_feed_cards_search ON feed_cards 
  USING gin(search_vector);
```

### RLSç­–ç•¥

```sql
-- ç”¨æˆ·åªèƒ½ä¿®æ”¹è‡ªå·±çš„æ•°æ®
CREATE POLICY "Users can update own profile"
  ON profiles FOR UPDATE
  USING (auth.uid() = id);

-- å…¬å¼€å†…å®¹æ‰€æœ‰äººå¯è§
CREATE POLICY "Public cards are viewable"
  ON feed_cards FOR SELECT
  USING (visibility = 'public');
```

---

## APIè®¾è®¡

### RESTful API

#### FeedæµAPI
```typescript
GET /api/feed
  Query: { cursor?, limit?, type? }
  Response: { cards: FeedCard[], nextCursor?, hasMore }

GET /api/feed/:id
  Response: FeedCard

POST /api/feed
  Body: { type, content, ... }
  Response: FeedCard
```

#### å­¦ä¹ ç³»ç»ŸAPI
```typescript
GET /api/chapters/:id
  Response: Chapter

GET /api/challenges/:chapterId
  Response: Challenge[]

POST /api/challenges/:id/submit
  Body: { answer: UserAnswer }
  Response: ChallengeResult
```

#### ç¤¾äº¤äº’åŠ¨API
```typescript
POST /api/interactions
  Body: { targetId, type, content? }
  Response: Interaction

DELETE /api/interactions/:id
  Response: { success: boolean }
```

### Edge Functions

#### AIè¯„åˆ†å‡½æ•°
```typescript
// supabase/functions/score-challenge/index.ts
POST /functions/v1/score-challenge
  Body: { 
    challengeId: string
    userAnswer: any
    context: LearningContext
  }
  Response: {
    score: number
    feedback: string
    suggestions: string[]
  }
```

#### AIåé¦ˆå‡½æ•°
```typescript
// supabase/functions/generate-feedback/index.ts
POST /functions/v1/generate-feedback
  Body: {
    userId: string
    progressData: UserProgress[]
  }
  Response: AIFeedback
```

---

## å‰ç«¯æ¶æ„

### ç»„ä»¶å±‚çº§

```
App
â”œâ”€â”€ Layout
â”‚   â”œâ”€â”€ TopNav
â”‚   â”œâ”€â”€ Main
â”‚   â”‚   â”œâ”€â”€ FeedPage
â”‚   â”‚   â”‚   â”œâ”€â”€ FeedContainer
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ CardFactory
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ QuestCard
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ TextCard
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ MediaCard
â”‚   â”‚   â”‚   â””â”€â”€ PullToRefresh
â”‚   â”‚   â”œâ”€â”€ CardDetailPage
â”‚   â”‚   â””â”€â”€ LearnPage
â”‚   â”‚       â”œâ”€â”€ ReaderView
â”‚   â”‚       â”œâ”€â”€ ChallengeView
â”‚   â”‚       â”‚   â”œâ”€â”€ VocabularyChallenge
â”‚   â”‚       â”‚   â”œâ”€â”€ GrammarChallenge
â”‚   â”‚       â”‚   â””â”€â”€ ComprehensionChallenge
â”‚   â”‚       â””â”€â”€ ResultView
â”‚   â””â”€â”€ BottomNav
â””â”€â”€ Providers
    â”œâ”€â”€ ThemeProvider
    â”œâ”€â”€ QueryProvider
    â””â”€â”€ AuthProvider
```

### çŠ¶æ€ç®¡ç†ç­–ç•¥

#### Zustand (å…¨å±€çŠ¶æ€)
```typescript
// ç”¨æˆ·çŠ¶æ€
interface UserStore {
  user: User | null
  setUser: (user: User) => void
  logout: () => void
}

// UIçŠ¶æ€
interface UIStore {
  theme: 'light' | 'dark'
  bottomNavVisible: boolean
  setTheme: (theme) => void
}
```

#### TanStack Query (æœåŠ¡ç«¯çŠ¶æ€)
```typescript
// FeedæŸ¥è¯¢
const { data, fetchNextPage } = useInfiniteQuery({
  queryKey: ['feed'],
  queryFn: fetchFeed,
  getNextPageParam: (lastPage) => lastPage.nextCursor,
})

// å®æ—¶è®¢é˜…
useEffect(() => {
  const channel = supabase
    .channel('feed-changes')
    .on('postgres_changes', { ... }, handler)
    .subscribe()
  
  return () => supabase.removeChannel(channel)
}, [])
```

### è·¯ç”±è®¾è®¡

```
/                     â†’ é‡å®šå‘åˆ° /feed
/feed                 â†’ Feedæµé¦–é¡µ
/card/:id             â†’ å¡ç‰‡è¯¦æƒ…é¡µ
/learn/:chapterId/read      â†’ é˜…è¯»é¡µé¢
/learn/:chapterId/challenge â†’ æŒ‘æˆ˜é¡µé¢
/learn/:chapterId/result    â†’ ç»“æœé¡µé¢
/profile/:userId      â†’ ç”¨æˆ·ä¸»é¡µ
/settings             â†’ è®¾ç½®é¡µé¢
```

---

## æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–

#### 1. è™šæ‹Ÿæ»šåŠ¨
```typescript
// ä½¿ç”¨React Virtuoso
<Virtuoso
  data={cards}
  overscan={200}
  itemContent={renderCard}
/>
```

#### 2. å›¾ç‰‡ä¼˜åŒ–
```typescript
// ä½¿ç”¨Next/Image
<Image
  src={url}
  width={800}
  height={600}
  placeholder="blur"
  loading="lazy"
/>
```

#### 3. ä»£ç åˆ†å‰²
```typescript
// åŠ¨æ€å¯¼å…¥
const ChallengeModule = dynamic(
  () => import('@/components/learn/Challenge'),
  { loading: () => <Skeleton /> }
)
```

#### 4. é¢„åŠ è½½
```typescript
// é¢„åŠ è½½ä¸‹ä¸€é¡µæ•°æ®
const { prefetchNextPage } = useInfiniteQuery(...)
useEffect(() => {
  if (shouldPrefetch) prefetchNextPage()
}, [shouldPrefetch])
```

### åç«¯ä¼˜åŒ–

#### 1. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
```sql
-- ä½¿ç”¨è§†å›¾é¢„è®¡ç®—
CREATE VIEW feed_with_details AS
SELECT fc.*, p.username, ...
FROM feed_cards fc
LEFT JOIN profiles p ON fc.author_id = p.id;

-- ä½¿ç”¨ç´¢å¼•
CREATE INDEX idx_feed_created ON feed_cards(created_at DESC);
```

#### 2. ç¼“å­˜ç­–ç•¥
```typescript
// TanStack Queryç¼“å­˜
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 2 * 60 * 1000, // 2åˆ†é’Ÿ
      cacheTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ
    },
  },
})
```

#### 3. ISRç­–ç•¥
```typescript
// é™æ€ç”Ÿæˆ + å¢é‡æ›´æ–°
export const revalidate = 60 // 60ç§’

export async function generateStaticParams() {
  const cards = await getFeaturedCards()
  return cards.map(card => ({ id: card.id }))
}
```

---

## å®‰å…¨è®¾è®¡

### è®¤è¯å’Œæˆæƒ

#### 1. Supabase Auth
```typescript
// ç”¨æˆ·æ³¨å†Œ
const { data, error } = await supabase.auth.signUp({
  email,
  password,
})

// ç”¨æˆ·ç™»å½•
const { data, error } = await supabase.auth.signInWithPassword({
  email,
  password,
})
```

#### 2. RLSç­–ç•¥
```sql
-- ç”¨æˆ·åªèƒ½ä¿®æ”¹è‡ªå·±çš„æ•°æ®
CREATE POLICY "Users update own data"
  ON user_progress FOR UPDATE
  USING (auth.uid() = user_id);
```

### æ•°æ®éªŒè¯

#### 1. ZodéªŒè¯
```typescript
const FeedCardSchema = z.object({
  type: z.enum(['novel', 'text', 'image']),
  title: z.string().min(1).max(255),
  content: z.record(z.any()),
})
```

#### 2. APIéªŒè¯
```typescript
// API Route
export async function POST(req: Request) {
  const body = await req.json()
  const validated = FeedCardSchema.parse(body)
  // ...
}
```

### XSSé˜²æŠ¤

```typescript
// ä½¿ç”¨DOMPurifyæ¸…ç†HTML
import DOMPurify from 'dompurify'

const clean = DOMPurify.sanitize(userContent)
```

### CSRFé˜²æŠ¤

```typescript
// Next.jsè‡ªåŠ¨å¤„ç†CSRF
// ä½¿ç”¨SameSite cookies
```

---

## ç›‘æ§å’Œæ—¥å¿—

### æ€§èƒ½ç›‘æ§
```typescript
// Vercel Analytics
import { Analytics } from '@vercel/analytics/react'

<Analytics />
```

### é”™è¯¯è¿½è¸ª
```typescript
// Sentry
import * as Sentry from '@sentry/nextjs'

Sentry.init({
  dsn: process.env.SENTRY_DSN,
})
```

### æ—¥å¿—è®°å½•
```typescript
// ç»“æ„åŒ–æ—¥å¿—
console.log({
  level: 'info',
  message: 'User completed challenge',
  userId,
  challengeId,
  score,
})
```

---

## éƒ¨ç½²æ¶æ„

### ç”Ÿäº§ç¯å¢ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Vercel Edge Network           â”‚
â”‚         (å…¨çƒ CDN + è‡ªåŠ¨æ‰©å±•)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Next.js API Routes               â”‚
â”‚      (Serverless Functions)              â”‚
â”‚  â”œâ”€ è‡ªåŠ¨ HTTPS                            â”‚
â”‚  â”œâ”€ ç¯å¢ƒå˜é‡ç®¡ç†                          â”‚
â”‚  â””â”€ æ—¥å¿—ç›‘æ§                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Supabase PostgreSQL              â”‚
â”‚      (æ‰˜ç®¡æ•°æ®åº“ + è®¤è¯)                   â”‚
â”‚  â”œâ”€ Row Level Security                   â”‚
â”‚  â”œâ”€ è‡ªåŠ¨å¤‡ä»½                              â”‚
â”‚  â””â”€ å®æ—¶è®¢é˜…                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CI/CDæµç¨‹

```
Git Push â†’ GitHub Actions
  â†’ Run Tests
  â†’ Build
  â†’ Deploy to Vercel (Preview)
  â†’ Manual Approval
  â†’ Deploy to Production
```

### å¤šç«¯æ”¯æŒ

#### Web åº”ç”¨
```typescript
const response = await fetch('/api/feed', {
  headers: { 'Authorization': `Bearer ${token}` }
});
```

#### å¾®ä¿¡å°ç¨‹åº
```javascript
wx.request({
  url: 'https://your-domain.vercel.app/api/feed',
  header: { 'Authorization': 'Bearer ' + token }
});
```

#### iOS/Android
```swift
// iOS
let request = URLRequest(url: URL(string: "https://your-domain.vercel.app/api/feed")!)
request.setValue("Bearer \(token)", forHTTPHeaderField: "Authorization")
```

---

## æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•
- Supabaseè‡ªåŠ¨æ‰©å±•
- Vercel Edge Functionså…¨çƒåˆ†å¸ƒ
- CDNç¼“å­˜é™æ€èµ„æº

### å‚ç›´æ‰©å±•
- æ•°æ®åº“è¿æ¥æ± 
- è¯»å†™åˆ†ç¦»
- ç¼“å­˜å±‚(Redis)

### åŠŸèƒ½æ‰©å±•
- æ’ä»¶åŒ–æŒ‘æˆ˜ç³»ç»Ÿ
- å¯é…ç½®çš„å¡ç‰‡ç±»å‹
- æ¨¡å—åŒ–çš„AIæœåŠ¡

---

## æ€»ç»“

LinguaFlowé‡‡ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆå’Œæ¶æ„è®¾è®¡ï¼Œç¡®ä¿ï¼š

âœ… **é«˜æ€§èƒ½**: è™šæ‹Ÿæ»šåŠ¨ã€å›¾ç‰‡ä¼˜åŒ–ã€ä»£ç åˆ†å‰²
âœ… **å¯æ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡ã€æ’ä»¶ç³»ç»Ÿ
âœ… **å®‰å…¨æ€§**: RLSã€æ•°æ®éªŒè¯ã€XSSé˜²æŠ¤
âœ… **ç”¨æˆ·ä½“éªŒ**: æµç•…åŠ¨ç”»ã€å®æ—¶æ›´æ–°ã€ç¦»çº¿æ”¯æŒ
âœ… **å¼€å‘æ•ˆç‡**: TypeScriptã€ç»„ä»¶å¤ç”¨ã€è‡ªåŠ¨åŒ–éƒ¨ç½²

è¿™å¥—æ¶æ„èƒ½å¤Ÿæ”¯æ’‘ä»MVPåˆ°ç™¾ä¸‡ç”¨æˆ·çš„æˆé•¿ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚
