# æ•°æ®åº“ç»“æ„å¯¹æ¯”åˆ†æ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å¯¹æ¯”äº†Supabaseæ•°æ®åº“ç»“æ„å’Œæœ¬åœ°TypeScriptç±»å‹å®šä¹‰ï¼Œè¯†åˆ«å·®å¼‚å¹¶æä¾›è§£å†³æ–¹æ¡ˆã€‚

## ğŸ” ç»“æ„å¯¹æ¯”

### 1. ç”¨æˆ·èµ„æ–™è¡¨ (profiles)

#### âœ… å®Œå…¨åŒ¹é…
| å­—æ®µ | æ•°æ®åº“ç±»å‹ | æœ¬åœ°ç±»å‹ | çŠ¶æ€ |
|------|------------|----------|------|
| id | UUID | string | âœ… |
| username | VARCHAR(50) | string | âœ… |
| display_name | TEXT | string \| null | âœ… |
| avatar_url | TEXT | string \| null | âœ… |
| bio | TEXT | string \| null | âœ… |
| level | INTEGER | number | âœ… |
| experience | INTEGER | number | âœ… |
| streak_days | INTEGER | number | âœ… |
| last_active_at | TIMESTAMP | string | âœ… |
| created_at | TIMESTAMP | string | âœ… |
| updated_at | TIMESTAMP | string | âœ… |

### 2. Feedå¡ç‰‡è¡¨ (feed_cards)

#### âš ï¸ éƒ¨åˆ†åŒ¹é… - éœ€è¦æ›´æ–°

**æ•°æ®åº“ç»“æ„ï¼š**
```sql
CREATE TABLE public.feed_cards (
  id UUID PRIMARY KEY,
  type VARCHAR(20) CHECK (type IN ('novel', 'text', 'image', 'video', 'audio', 'ad')),
  title TEXT,
  content JSONB,
  author_id UUID,
  likes_count INTEGER,
  comments_count INTEGER,
  shares_count INTEGER,
  views_count INTEGER,
  visibility VARCHAR(20),
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);
```

**æœ¬åœ°ç±»å‹å®šä¹‰ï¼š**
```typescript
export type FeedCardType = 'novel' | 'text' | 'media' | 'audio' | 'ad' | 'quote' | 'repost';
```

#### ğŸš¨ å·®å¼‚åˆ†æï¼š

1. **ç±»å‹ä¸åŒ¹é…ï¼š**
   - æ•°æ®åº“ï¼š`'novel', 'text', 'image', 'video', 'audio', 'ad'`
   - æœ¬åœ°ï¼š`'novel', 'text', 'media', 'audio', 'ad', 'quote', 'repost'`
   - å·®å¼‚ï¼šç¼ºå°‘ `quote`, `repost` ç±»å‹ï¼Œç¼ºå°‘ `image`, `video` åˆ†ç¦»

2. **å­—æ®µç¼ºå¤±ï¼š**
   - æ•°æ®åº“ç¼ºå°‘ï¼š`difficulty`, `tags`, `metadata`
   - æœ¬åœ°ç±»å‹ç¼ºå°‘ï¼š`title` å­—æ®µ

### 3. äº¤äº’è¡¨ (interactions)

#### âŒ ä¸åŒ¹é… - éœ€è¦é‡æ„

**æ•°æ®åº“ç»“æ„ï¼š**
```sql
CREATE TABLE public.interactions (
  id UUID PRIMARY KEY,
  user_id UUID,
  target_id UUID,
  target_type VARCHAR(20) CHECK (target_type IN ('card', 'comment')),
  type VARCHAR(20) CHECK (type IN ('like', 'comment', 'share', 'bookmark')),
  content TEXT
);
```

**æœ¬åœ°ç±»å‹å®šä¹‰ï¼š**
```typescript
export type InteractionType = 'like' | 'unlike' | 'repost' | 'unrepost' | 'bookmark' | 'unbookmark' | 'reply' | 'quote' | 'share';
```

#### ğŸš¨ å·®å¼‚åˆ†æï¼š

1. **ç±»å‹ä¸åŒ¹é…ï¼š**
   - æ•°æ®åº“ï¼š`'like', 'comment', 'share', 'bookmark'`
   - æœ¬åœ°ï¼š`'like', 'unlike', 'repost', 'unrepost', 'bookmark', 'unbookmark', 'reply', 'quote', 'share'`
   - å·®å¼‚ï¼šæ•°æ®åº“ç¼ºå°‘ `unlike`, `repost`, `unrepost`, `unbookmark`, `reply`, `quote` ç±»å‹

2. **è®¾è®¡ç†å¿µå·®å¼‚ï¼š**
   - æ•°æ®åº“ï¼šç®€å•çŠ¶æ€å­˜å‚¨
   - æœ¬åœ°ï¼šå¤æ‚äº¤äº’çŠ¶æ€ç®¡ç†

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæ›´æ–°æ•°æ®åº“ç»“æ„ï¼ˆæ¨èï¼‰

#### 1. æ›´æ–°Feedå¡ç‰‡è¡¨
```sql
-- æ·»åŠ ç¼ºå¤±å­—æ®µ
ALTER TABLE public.feed_cards 
ADD COLUMN difficulty INTEGER CHECK (difficulty BETWEEN 1 AND 5),
ADD COLUMN tags TEXT[],
ADD COLUMN metadata JSONB DEFAULT '{}'::jsonb;

-- æ›´æ–°ç±»å‹çº¦æŸ
ALTER TABLE public.feed_cards 
DROP CONSTRAINT IF EXISTS feed_cards_type_check;

ALTER TABLE public.feed_cards 
ADD CONSTRAINT feed_cards_type_check 
CHECK (type IN ('novel', 'text', 'image', 'video', 'audio', 'ad', 'quote', 'repost'));
```

#### 2. æ›´æ–°äº¤äº’è¡¨
```sql
-- æ›´æ–°ç±»å‹çº¦æŸ
ALTER TABLE public.interactions 
DROP CONSTRAINT IF EXISTS interactions_type_check;

ALTER TABLE public.interactions 
ADD CONSTRAINT interactions_type_check 
CHECK (type IN ('like', 'unlike', 'comment', 'reply', 'share', 'repost', 'unrepost', 'bookmark', 'unbookmark', 'quote'));
```

### æ–¹æ¡ˆ2ï¼šæ›´æ–°æœ¬åœ°ç±»å‹å®šä¹‰

#### 1. æ›´æ–°Feedç±»å‹
```typescript
// src/types/feed.ts
export type FeedCardType = 
  | 'novel' 
  | 'text' 
  | 'image'      // ä»æ•°æ®åº“
  | 'video'      // ä»æ•°æ®åº“
  | 'audio' 
  | 'ad'
  | 'quote'      // éœ€è¦æ•°æ®åº“æ”¯æŒ
  | 'repost';    // éœ€è¦æ•°æ®åº“æ”¯æŒ
```

#### 2. æ›´æ–°äº¤äº’ç±»å‹
```typescript
// src/types/feed.ts
export type InteractionType = 
  | 'like'
  | 'comment'    // ä»æ•°æ®åº“
  | 'share'
  | 'bookmark'
  | 'reply'      // éœ€è¦æ•°æ®åº“æ”¯æŒ
  | 'quote'      // éœ€è¦æ•°æ®åº“æ”¯æŒ
  | 'repost';    // éœ€è¦æ•°æ®åº“æ”¯æŒ
```

## ğŸ“Š å½±å“è¯„ä¼°

### é«˜å½±å“å·®å¼‚
1. **Feedå¡ç‰‡ç±»å‹ä¸åŒ¹é…** - å½±å“å†…å®¹åˆ›å»ºå’Œæ˜¾ç¤º
2. **äº¤äº’ç±»å‹ä¸åŒ¹é…** - å½±å“ç”¨æˆ·äº’åŠ¨åŠŸèƒ½

### ä¸­å½±å“å·®å¼‚
1. **å­—æ®µç¼ºå¤±** - å½±å“åŠŸèƒ½å®Œæ•´æ€§
2. **ç±»å‹çº¦æŸ** - å½±å“æ•°æ®éªŒè¯

### ä½å½±å“å·®å¼‚
1. **å‘½åå·®å¼‚** - å½±å“ä»£ç å¯è¯»æ€§
2. **ç»“æ„å·®å¼‚** - å½±å“APIè®¾è®¡

## ğŸ¯ æ¨èè¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨
1. **æ›´æ–°æ•°æ®åº“è¿ç§»æ–‡ä»¶** - æ·»åŠ ç¼ºå¤±å­—æ®µå’Œç±»å‹
2. **æ›´æ–°æœ¬åœ°ç±»å‹å®šä¹‰** - ä¿æŒä¸€è‡´æ€§
3. **æ›´æ–°APIæ¥å£** - æ”¯æŒæ–°çš„æ•°æ®ç»“æ„

### åç»­ä¼˜åŒ–
1. **æ€§èƒ½ä¼˜åŒ–** - æ·»åŠ å¿…è¦çš„ç´¢å¼•
2. **æ•°æ®éªŒè¯** - åŠ å¼ºçº¦æŸæ¡ä»¶
3. **APIæ–‡æ¡£** - æ›´æ–°æ¥å£æ–‡æ¡£

## ğŸ“ å®æ–½è®¡åˆ’

### é˜¶æ®µ1ï¼šæ•°æ®åº“æ›´æ–°
- [ ] åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶
- [ ] æ·»åŠ ç¼ºå¤±å­—æ®µ
- [ ] æ›´æ–°ç±»å‹çº¦æŸ
- [ ] æµ‹è¯•æ•°æ®åº“æ›´æ–°

### é˜¶æ®µ2ï¼šç±»å‹å®šä¹‰æ›´æ–°
- [ ] æ›´æ–°æœ¬åœ°ç±»å‹å®šä¹‰
- [ ] æ›´æ–°APIæ¥å£
- [ ] æ›´æ–°ç»„ä»¶ç±»å‹
- [ ] æµ‹è¯•ç±»å‹å…¼å®¹æ€§

### é˜¶æ®µ3ï¼šåŠŸèƒ½æµ‹è¯•
- [ ] æµ‹è¯•å†…å®¹åˆ›å»º
- [ ] æµ‹è¯•ç”¨æˆ·äº’åŠ¨
- [ ] æµ‹è¯•æ•°æ®æŸ¥è¯¢
- [ ] æ€§èƒ½æµ‹è¯•

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ•°æ®åº“è¿ç§»ç¤ºä¾‹
```sql
-- æ·»åŠ æ–°å­—æ®µ
ALTER TABLE public.feed_cards 
ADD COLUMN difficulty INTEGER CHECK (difficulty BETWEEN 1 AND 5),
ADD COLUMN tags TEXT[],
ADD COLUMN metadata JSONB DEFAULT '{}'::jsonb;

-- æ›´æ–°ç±»å‹çº¦æŸ
ALTER TABLE public.feed_cards 
DROP CONSTRAINT IF EXISTS feed_cards_type_check;

ALTER TABLE public.feed_cards 
ADD CONSTRAINT feed_cards_type_check 
CHECK (type IN ('novel', 'text', 'image', 'video', 'audio', 'ad', 'quote', 'repost'));
```

### ç±»å‹å®šä¹‰æ›´æ–°ç¤ºä¾‹
```typescript
// æ›´æ–°Feedå¡ç‰‡ç±»å‹
export interface FeedCard {
  id: string;
  type: FeedCardType;
  title?: string;        // æ–°å¢
  content: Json;
  author_id: string;
  difficulty?: number;   // æ–°å¢
  tags?: string[];       // æ–°å¢
  metadata?: Json;       // æ–°å¢
  likes_count: number;
  comments_count: number;
  shares_count: number;
  views_count: number;
  visibility: string;
  created_at: string;
  updated_at: string;
}
```

## ğŸ“ˆ æ€»ç»“

é€šè¿‡å¯¹æ¯”åˆ†æï¼Œå‘ç°æ•°æ®åº“ç»“æ„å’Œæœ¬åœ°ç±»å‹å®šä¹‰å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚å»ºè®®é‡‡ç”¨**æ–¹æ¡ˆ1**ï¼ˆæ›´æ–°æ•°æ®åº“ç»“æ„ï¼‰ï¼Œå› ä¸ºï¼š

1. **åŠŸèƒ½å®Œæ•´æ€§** - æ”¯æŒæ‰€æœ‰è®¡åˆ’çš„åŠŸèƒ½
2. **æ‰©å±•æ€§** - ä¸ºæœªæ¥åŠŸèƒ½é¢„ç•™ç©ºé—´
3. **ä¸€è‡´æ€§** - ä¿æŒå‰åç«¯æ•°æ®ç»“æ„ä¸€è‡´
4. **ç»´æŠ¤æ€§** - å‡å°‘ç±»å‹è½¬æ¢çš„å¤æ‚æ€§

å®æ–½åï¼Œå°†å®ç°æ•°æ®åº“ç»“æ„å’Œæœ¬åœ°ç±»å‹å®šä¹‰çš„å®Œå…¨åŒ¹é…ï¼Œä¸ºé¡¹ç›®æä¾›åšå®çš„æ•°æ®åŸºç¡€ã€‚
