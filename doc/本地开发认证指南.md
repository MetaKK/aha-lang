# 🔧 本地开发认证指南

## 概述

为了简化本地开发，我们实现了一个**模拟认证系统**，让你可以快速测试不同用户角色的功能，无需配置真实的 Supabase 后端。

## 🚀 快速开始

### 1. 启用模拟认证

创建 `.env.local` 文件：

```bash
# 开发模式配置
NEXT_PUBLIC_ENABLE_MOCK_AUTH=true
NEXT_PUBLIC_MOCK_USER_TYPE=user
NEXT_PUBLIC_ENABLE_BACKEND_SYNC=false
```

### 2. 启动开发服务器

```bash
npm run dev
```

### 3. 使用开发工具

在浏览器右下角会看到一个 🔧 按钮，点击可以：

- **快速切换用户角色**
- **查看当前用户信息**
- **模拟登录/登出**

## 👥 预设用户角色

### 管理员 (admin)
- **邮箱**: `admin@linguaflow.com`
- **密码**: 任意密码
- **权限**: 全部权限
- **等级**: 50
- **经验**: 5000

### 普通用户 (user)
- **邮箱**: `user@linguaflow.com`
- **密码**: 任意密码
- **权限**: 基础权限
- **等级**: 10
- **经验**: 1000

### 访客 (guest)
- **邮箱**: `guest@linguaflow.com`
- **密码**: 任意密码
- **权限**: 无权限
- **等级**: 1
- **经验**: 0

## 🎯 使用场景

### 测试不同权限
1. 点击 🔧 按钮
2. 选择不同用户角色
3. 测试功能权限差异

### 测试认证流程
1. 访问需要登录的功能
2. 系统会自动提示登录
3. 使用任意邮箱密码登录
4. 系统根据邮箱自动分配角色

### 测试Quest跳转
1. 登录后浏览Feed
2. 点击Quest卡片
3. 应该正确跳转到 `/quest/[id]` 页面

## 🔧 开发工具功能

### 快速登录
- 一键切换用户角色
- 实时查看用户信息
- 权限状态显示

### 用户信息面板
- 当前用户状态
- 权限列表
- 经验值和等级
- 连续学习天数

## 🛠️ 技术实现

### 模拟认证系统
```typescript
// 自动检测开发环境
if (isLocalDevelopment() && process.env.NEXT_PUBLIC_ENABLE_MOCK_AUTH === 'true') {
  // 使用模拟认证
  const mockSession = getMockSession();
  // ...
}
```

### 用户角色切换
```typescript
// 根据邮箱自动分配角色
let userType: 'admin' | 'user' | 'guest' = 'user';
if (email.includes('admin')) userType = 'admin';
else if (email.includes('guest')) userType = 'guest';
```

### 权限检查
```typescript
// 模拟权限验证
const hasPermission = (permission: string) => {
  const permissions = session.user.user_metadata?.permissions || [];
  return permissions.includes(permission);
};
```

## 📱 多端支持

### Web 应用
- 完整的模拟认证
- 开发工具面板
- 权限测试

### 微信小程序
- 相同的API接口
- 相同的认证流程
- 相同的权限系统

## 🔄 生产环境切换

### 禁用模拟认证
```bash
# .env.local
NEXT_PUBLIC_ENABLE_MOCK_AUTH=false
NEXT_PUBLIC_ENABLE_BACKEND_SYNC=true
```

### 配置真实Supabase
```bash
# .env.local
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

## 🐛 故障排除

### Quest卡片跳转404
1. 检查路由文件是否存在: `src/app/(main)/quest/[id]/page.tsx`
2. 检查卡片类型判断逻辑
3. 确认Quest卡片有正确的metadata

### 模拟认证不工作
1. 检查环境变量设置
2. 确认开发环境模式
3. 清除浏览器缓存

### 权限检查失败
1. 检查用户角色分配
2. 确认权限列表配置
3. 查看控制台错误信息

## 📚 相关文档

- [后端API重构完成总结](./后端API重构完成总结.md)
- [认证系统完整文档](./认证系统完整文档.md)
- [API文档](./API文档.md)

## 🎉 总结

通过模拟认证系统，你可以：

✅ **快速测试** - 无需配置后端即可测试所有功能  
✅ **多角色测试** - 一键切换不同用户角色  
✅ **权限验证** - 测试不同权限级别的功能  
✅ **Quest跳转** - 验证Quest卡片正确跳转  
✅ **开发效率** - 专注于前端功能开发  

**现在你可以愉快地进行本地开发了！** 🚀
