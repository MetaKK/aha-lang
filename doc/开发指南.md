# 🛠️ LinguaFlow 开发指南

## 📋 开发环境配置

### 环境要求
- Node.js >= 20
- pnpm >= 9
- Git

### 快速启动
```bash
# 1. 克隆项目
git clone <repository-url>
cd linguaflow

# 2. 安装依赖
pnpm install

# 3. 启动开发服务器
pnpm dev

# 4. 访问应用
# 打开浏览器访问 http://localhost:3000
```

## 🔌 API 接口

### 基础配置
- **Base URL**: `https://your-domain.vercel.app/api`
- **认证方式**: JWT Bearer Token
- **响应格式**: 统一JSON格式

### 核心接口

#### Feed 流接口
```typescript
// 获取 Feed 流
GET /api/feed?page=1&pageSize=20&type=novel

// 获取卡片详情
GET /api/feed/:id

// 创建卡片
POST /api/feed
Authorization: Bearer <token>
```

#### 用户接口
```typescript
// 获取用户资料
GET /api/users/:id

// 更新用户资料
PUT /api/users/:id
Authorization: Bearer <token>
```

#### 互动接口
```typescript
// 创建互动（点赞、评论等）
POST /api/interactions
Authorization: Bearer <token>

// 删除互动
DELETE /api/interactions?targetId=xxx&type=like
Authorization: Bearer <token>
```

### 统一响应格式
```typescript
// 成功响应
{
  "success": true,
  "data": { ... },
  "message": "操作成功",
  "timestamp": "2025-01-25T10:00:00.000Z"
}

// 错误响应
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "错误描述",
    "details": { ... }
  },
  "timestamp": "2025-01-25T10:00:00.000Z"
}
```

---

## 🏗️ 项目结构

```
linguaflow/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── (main)/            # 主应用布局
│   │   │   ├── feed/          # Feed 流页面
│   │   │   ├── post/[id]/     # 帖子详情页
│   │   │   └── page.tsx       # 首页
│   │   ├── layout.tsx         # 根布局
│   │   └── globals.css        # 全局样式
│   │
│   ├── components/            # React 组件
│   │   ├── feed/              # Feed 相关组件
│   │   │   ├── cards/         # 卡片组件
│   │   │   ├── feed-header.tsx
│   │   │   ├── feed-list.tsx
│   │   │   └── post-card/     # 帖子卡片组件
│   │   │       ├── index.tsx
│   │   │       ├── novel-card.tsx
│   │   │       ├── text-card.tsx
│   │   │       ├── media-card.tsx
│   │   │       ├── post-author.tsx
│   │   │       ├── post-content.tsx
│   │   │       └── post-actions.tsx
│   │   ├── providers/         # Context Providers
│   │   │   ├── theme-provider.tsx
│   │   │   └── query-provider.tsx
│   │   └── ui/                # UI 组件库
│   │       ├── badge.tsx
│   │       ├── button.tsx
│   │       └── card.tsx
│   │
│   ├── hooks/                 # 自定义 Hooks
│   │   ├── use-like.ts
│   │   └── use-realtime.ts
│   │
│   ├── lib/                   # 工具库
│   │   ├── api/               # API 层
│   │   │   └── feed.ts
│   │   ├── challenges/        # 挑战系统
│   │   │   ├── plugin-system.ts
│   │   │   └── plugins/
│   │   │       └── vocabulary-plugin.tsx
│   │   ├── storage/           # 存储系统
│   │   │   └── hyper-storage.ts
│   │   ├── supabase/          # Supabase 客户端
│   │   │   ├── client.ts
│   │   │   └── server.ts
│   │   ├── sync/              # 数据同步
│   │   │   ├── data-sync.ts
│   │   │   └── schema-version.ts
│   │   └── utils.ts
│   │
│   ├── types/                 # TypeScript 类型
│   │   ├── feed.ts
│   │   ├── learn.ts
│   │   └── supabase.ts
│   │
│   └── config/                # 配置文件
│       └── constants.ts
│
├── supabase/                  # Supabase 配置
│   └── migrations/            # 数据库迁移
│       └── 20250124000001_initial_schema.sql
│
├── public/                    # 静态资源
│   └── manifest.json
│
├── doc/                       # 文档
│   ├── README.md
│   ├── 快速开始.md
│   ├── 项目概述.md
│   ├── 架构设计.md
│   ├── 部署指南.md
│   ├── 功能测试.md
│   ├── 项目使用文档.md
│   └── 开发指南.md
│
├── scripts/                   # 脚本
│   └── check-data-sync.ts
│
├── package.json
├── pnpm-lock.yaml
├── pnpm-workspace.yaml
├── next.config.ts
├── postcss.config.mjs
├── tailwind.config.ts
├── tsconfig.json
└── start.sh
```

---

## 🎨 核心功能

### Feed 流系统
- **卡片类型**: novel, text, media, audio, ad, quote, repost
- **主要组件**: FeedListSimple, PostCard, QuestCard, TextCard, MediaCard
- **状态管理**: Zustand + React Query
- **实时更新**: Supabase Realtime

### 认证系统
- **登录注册**: 完整的用户认证流程
- **权限控制**: 基于角色的访问控制
- **安全特性**: JWT Token + RLS

### 数据管理
- **本地存储**: IndexedDB + localStorage (开发模式)
- **云端同步**: Supabase (生产模式)
- **Mock数据**: 完整的测试数据

---

## 🔧 环境配置

### 开发环境
```bash
# 环境变量
NEXT_PUBLIC_ENABLE_BACKEND_SYNC=false  # 本地存储模式
NEXT_PUBLIC_APP_URL=http://localhost:3000
NODE_ENV=development
```

### 生产环境
```bash
# 环境变量
NEXT_PUBLIC_ENABLE_BACKEND_SYNC=true
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
```

## 🚀 常用命令

```bash
# 开发
pnpm dev              # 启动开发服务器
pnpm build            # 构建生产版本
pnpm start            # 启动生产服务器
pnpm type-check       # 类型检查
pnpm lint             # 代码检查
```

## 📚 相关文档

- [架构设计](./架构设计.md) - 完整技术架构
- [API文档](./API文档.md) - 后端接口规范
- [认证系统](./认证系统完整文档.md) - 登录注册系统
- [项目使用文档](./项目使用文档.md) - 详细使用说明

---

**Made with ❤️ by LinguaFlow Team**
