# 🧪 LinguaFlow 功能测试指南

## ✅ 本地Mock模式测试（推荐先测试）

### 1. 启动项目
```bash
cd /Users/xukaikai/Desktop/Amazon产品4Me/Code/aha-lang
pnpm dev
```

### 2. 打开浏览器
访问: http://localhost:3000

### 3. 测试步骤
1. ✅ 看到右下角蓝色圆形浮动按钮
2. ✅ 悬停在按钮上，看到"Create new content"提示
3. ✅ 点击按钮，展开5个选项菜单
4. ✅ 点击"Text Post"（蓝色）
5. ✅ 模态框弹出
6. ✅ 输入测试文本: "Hello World! This is my first post 🎉"
7. ✅ 点击"Post"按钮
8. ✅ 看到加载提示: "Creating post..."
9. ✅ 看到成功提示: "Post created successfully! 🎉"
10. ✅ **新帖子出现在Feed列表最顶部**
11. ✅ 帖子显示正确的内容、头像、时间

### 4. 控制台日志检查
打开浏览器DevTools (F12)，应该看到:
```
[HomePage] Creating post: Hello World! This is my first post 🎉
[createPost] Creating post: { content: "Hello World!", type: "text", MOCK_DATA_ENABLED: true }
[createPost] Mock post created: post-1234567890
[Mutation] Post created successfully: post-1234567890
[fetchFeed] Called with: { cursor: undefined, limit: 20, filters: undefined, MOCK_DATA_ENABLED: true }
[fetchFeed] Returning mock data: { start: 0, end: 20, cardsCount: 20, totalMockCards: 58 }
```

### 5. 验证结果
- [x] 新帖子在列表顶部
- [x] 作者显示为 "You"
- [x] 时间显示 "Just now" 或 "1s ago"
- [x] 点赞/转发/评论等统计都是0
- [x] 可以点赞/收藏新帖子

---

## 🌐 Supabase云端模式测试

### 前置条件
1. ✅ Supabase项目已创建
2. ✅ 数据库迁移已运行
3. ✅ 用户账号已创建（待实现登录功能）

### 1. 配置环境变量
```bash
# 创建 .env.local
cat > .env.local << 'EOF'
NEXT_PUBLIC_ENABLE_BACKEND_SYNC=true
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
EOF
```

### 2. 重启项目
```bash
# 停止当前进程 (Ctrl+C)
pnpm dev
```

### 3. 验证配置
打开控制台，应该看到:
```
[Feed API] Mock data enabled: false
[Feed API] Backend sync enabled: true
[Supabase] Client initialized successfully
```

### 4. 创建帖子
1. 重复上面的测试步骤
2. 控制台应显示:
```
[createPost] Creating post: { content: "...", type: "text", MOCK_DATA_ENABLED: false }
[createPost] Supabase post created: 123e4567-e89b-12d3-a456-426614174000
```

### 5. 验证数据库
在Supabase Dashboard:
1. 进入 **Table Editor**
2. 选择 `feed_cards` 表
3. ✅ 看到新创建的记录
4. ✅ 字段正确: type, content, author_id, created_at

---

## 🔄 切换模式测试

### Mock → Supabase
```bash
# 1. 停止项目
Ctrl+C

# 2. 修改环境变量
echo "NEXT_PUBLIC_ENABLE_BACKEND_SYNC=true" > .env.local

# 3. 重启
pnpm dev

# 4. 验证日志
# 应显示: Backend sync enabled: true
```

### Supabase → Mock
```bash
# 1. 停止项目
Ctrl+C

# 2. 删除或修改环境变量
echo "NEXT_PUBLIC_ENABLE_BACKEND_SYNC=false" > .env.local
# 或者直接删除
rm .env.local

# 3. 重启
pnpm dev

# 4. 验证日志
# 应显示: Mock data enabled: true
```

---

## 🐛 问题排查

### 问题1: 帖子创建后不显示
**检查**:
1. 控制台是否有错误
2. 是否看到成功提示
3. React Query是否正确invalidate

**解决**:
```typescript
// 确认这行代码存在
queryClient.invalidateQueries({ queryKey: ['feed'] });
```

### 问题2: 浮动按钮不显示
**检查**:
1. 页面是否加载完成
2. 按钮是否被其他元素遮挡
3. CSS样式是否正确

**解决**:
```css
/* 确认z-index足够高 */
.fixed.bottom-6.right-6.z-50
```

### 问题3: 模态框无法关闭
**检查**:
1. 点击背景或X按钮
2. 按ESC键（如果支持）

**解决**: 刷新页面

### 问题4: Supabase连接失败
**检查**:
```bash
# 验证环境变量
echo $NEXT_PUBLIC_SUPABASE_URL
echo $NEXT_PUBLIC_SUPABASE_ANON_KEY
```

**解决**:
1. 确认URL和Key正确
2. 确认Supabase项目正常运行
3. 检查网络连接

---

## 📊 性能测试

### 测试加载时间
```javascript
// 在控制台运行
console.time('createPost');
// 创建帖子
console.timeEnd('createPost');
// 应该 < 1000ms (Mock模式)
```

### 测试内存占用
1. 打开DevTools → Performance → Memory
2. 创建10个帖子
3. 检查内存增长是否正常
4. 执行垃圾回收
5. 内存应该回落

---

## 🎯 功能验证清单

### UI/UX
- [ ] FAB按钮平滑出现（延迟500ms）
- [ ] 悬停时按钮缩放 (1.05x)
- [ ] 点击时按钮缩小 (0.95x)
- [ ] 展开菜单动画流畅
- [ ] 模态框背景模糊效果
- [ ] Toast通知正确显示
- [ ] 字符计数实时更新
- [ ] 超过280字时显示红色

### 功能
- [ ] 创建文本帖子成功
- [ ] 新帖子出现在顶部
- [ ] 帖子内容正确
- [ ] 作者信息正确
- [ ] 时间戳正确
- [ ] 统计数据初始化为0
- [ ] 可以与新帖子互动

### 性能
- [ ] 创建帖子 < 1s
- [ ] Feed刷新 < 500ms
- [ ] 动画流畅60fps
- [ ] 无内存泄漏

---

## 🚀 下一步

测试通过后，可以：

1. **部署到Vercel**
```bash
git add .
git commit -m "feat: add create post functionality"
git push origin main
```

2. **配置Supabase生产环境**
- 在Vercel设置环境变量
- 启用Supabase Realtime
- 配置用户认证

3. **添加更多功能**
- 图片上传
- 视频上传
- 编辑和删除
- 定时发布

---

**测试愉快！** 🎉

如有问题，请查看:
- [项目概述.md](./项目概述.md)
- [部署指南.md](./部署指南.md)
