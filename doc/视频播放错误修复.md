# ğŸ¥ è§†é¢‘æ’­æ”¾é”™è¯¯ä¿®å¤

## é—®é¢˜åˆ†æ

### é”™è¯¯ä¿¡æ¯
```
Runtime AbortError: The play() request was interrupted because the media was removed from the document.
```

### é—®é¢˜åŸå› 
1. **DOMç§»é™¤æ—¶æœºé—®é¢˜**ï¼šè§†é¢‘å…ƒç´ åœ¨æ’­æ”¾è¿‡ç¨‹ä¸­è¢«ä»DOMä¸­ç§»é™¤
2. **å¼‚æ­¥æ’­æ”¾æœªå¤„ç†**ï¼š`video.play()`è¿”å›Promiseï¼Œä½†æœªæ­£ç¡®å¤„ç†ä¸­æ–­
3. **çŠ¶æ€ç®¡ç†å†²çª**ï¼šç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶å¯èƒ½ç§»é™¤æ­£åœ¨æ’­æ”¾çš„è§†é¢‘å…ƒç´ 

## ä¿®å¤æ–¹æ¡ˆ

### 1. å¼‚æ­¥æ’­æ”¾å¤„ç†

#### ä¿®å¤å‰
```typescript
// åŒæ­¥è°ƒç”¨ï¼Œæœªå¤„ç†ä¸­æ–­
const handleVideoPlay = (mediaId: string, event: React.MouseEvent) => {
  // ...
  videoRef.current?.play(); // å¯èƒ½æŠ›å‡ºAbortError
  setPlayingVideo(mediaId);
};
```

#### ä¿®å¤å
```typescript
// å¼‚æ­¥è°ƒç”¨ï¼Œæ­£ç¡®å¤„ç†ä¸­æ–­
const handleVideoPlay = async (mediaId: string, event: React.MouseEvent) => {
  // ...
  try {
    if (videoRef.current) {
      await videoRef.current.play(); // ç­‰å¾…æ’­æ”¾å¼€å§‹
      setPlayingVideo(mediaId);
    }
  } catch (error) {
    // ä¼˜é›…å¤„ç†æ’­æ”¾ä¸­æ–­
    if (error instanceof Error && error.name === 'AbortError') {
      console.log('Video play was interrupted');
    } else {
      console.error('Video play error:', error);
    }
    setPlayingVideo(null);
  }
};
```

### 2. éŸ³é¢‘æ’­æ”¾åŒæ­¥ä¿®å¤

```typescript
const handleAudioPlay = async (mediaId: string, event: React.MouseEvent) => {
  // ...
  try {
    if (audioRef.current) {
      await audioRef.current.play();
      setPlayingAudio(mediaId);
    }
  } catch (error) {
    if (error instanceof Error && error.name === 'AbortError') {
      console.log('Audio play was interrupted');
    } else {
      console.error('Audio play error:', error);
    }
    setPlayingAudio(null);
  }
};
```

## æŠ€æœ¯ç»†èŠ‚

### 1. AbortErrorå¤„ç†
```typescript
// æ£€æŸ¥é”™è¯¯ç±»å‹
if (error instanceof Error && error.name === 'AbortError') {
  // æ’­æ”¾è¢«ä¸­æ–­ï¼Œè¿™æ˜¯æ­£å¸¸æƒ…å†µ
  console.log('Media play was interrupted');
} else {
  // å…¶ä»–æ’­æ”¾é”™è¯¯
  console.error('Media play error:', error);
}
```

### 2. çŠ¶æ€é‡ç½®
```typescript
// æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½è¦é‡ç½®çŠ¶æ€
setPlayingVideo(null);
setPlayingAudio(null);
```

### 3. å…ƒç´ å­˜åœ¨æ€§æ£€æŸ¥
```typescript
// ç¡®ä¿å…ƒç´ å­˜åœ¨å†è°ƒç”¨play()
if (videoRef.current) {
  await videoRef.current.play();
}
```

## ä¿®å¤æ•ˆæœ

### âœ… é”™è¯¯æ¶ˆé™¤
- ä¸å†æŠ›å‡º`AbortError`
- æ’­æ”¾ä¸­æ–­æ—¶ä¼˜é›…å¤„ç†
- æ§åˆ¶å°ä¸å†æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

### âœ… ç”¨æˆ·ä½“éªŒæ”¹å–„
- è§†é¢‘æ’­æ”¾æ›´ç¨³å®š
- çŠ¶æ€ç®¡ç†æ›´å‡†ç¡®
- é”™è¯¯å¤„ç†æ›´å‹å¥½

### âœ… ä»£ç å¥å£®æ€§
- å¼‚æ­¥æ“ä½œæ­£ç¡®å¤„ç†
- é”™è¯¯è¾¹ç•Œå®Œå–„
- çŠ¶æ€åŒæ­¥å¯é 

## æµ‹è¯•éªŒè¯

### 1. æ­£å¸¸æ’­æ”¾æµ‹è¯•
```typescript
// ç‚¹å‡»æ’­æ”¾æŒ‰é’®
handleVideoPlay('video-1', event);
// åº”è¯¥æ­£å¸¸æ’­æ”¾ï¼Œæ— é”™è¯¯
```

### 2. ä¸­æ–­æ’­æ”¾æµ‹è¯•
```typescript
// å¿«é€Ÿåˆ‡æ¢è§†é¢‘
handleVideoPlay('video-1', event); // å¼€å§‹æ’­æ”¾
handleVideoPlay('video-2', event); // ç«‹å³åˆ‡æ¢
// åº”è¯¥ä¼˜é›…å¤„ç†ä¸­æ–­ï¼Œæ— AbortError
```

### 3. ç»„ä»¶å¸è½½æµ‹è¯•
```typescript
// åœ¨æ’­æ”¾è¿‡ç¨‹ä¸­å¸è½½ç»„ä»¶
// åº”è¯¥ä¸ä¼šæŠ›å‡ºé”™è¯¯
```

## æœ€ä½³å®è·µ

### 1. åª’ä½“æ’­æ”¾æ¨¡å¼
```typescript
// æ¨èï¼šä½¿ç”¨async/awaitå¤„ç†æ’­æ”¾
const playMedia = async (element: HTMLMediaElement) => {
  try {
    await element.play();
    return true;
  } catch (error) {
    if (error.name === 'AbortError') {
      return false; // æ’­æ”¾è¢«ä¸­æ–­
    }
    throw error; // å…¶ä»–é”™è¯¯
  }
};
```

### 2. çŠ¶æ€ç®¡ç†
```typescript
// æ¨èï¼šæ’­æ”¾çŠ¶æ€ä¸DOMçŠ¶æ€åŒæ­¥
const [playingId, setPlayingId] = useState<string | null>(null);

const handlePlay = async (id: string) => {
  try {
    await mediaElement.play();
    setPlayingId(id);
  } catch (error) {
    setPlayingId(null);
  }
};
```

### 3. æ¸…ç†å‡½æ•°
```typescript
// æ¨èï¼šç»„ä»¶å¸è½½æ—¶æ¸…ç†åª’ä½“
useEffect(() => {
  return () => {
    videoRef.current?.pause();
    audioRef.current?.pause();
  };
}, []);
```

---

**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ  
**é”™è¯¯æ¶ˆé™¤**: âœ… AbortErrorä¸å†å‡ºç°  
**æ’­æ”¾ç¨³å®šæ€§**: âœ… æ˜¾è‘—æå‡  
**ç”¨æˆ·ä½“éªŒ**: âœ… æµç•…æ— å¡é¡¿
